<style>

    .nav-link {
        border-bottom: 2px solid transparent;
        border-radius: var(--bs-border-radius);
        transition: border-color .1s ease-in-out, border-radius .1s ease-in-out;
    }

        .nav-link:hover {
            border-bottom-color: currentColor;
            border-radius: 0;
        }

        .nav-link.active {
            border-bottom-color: currentColor;
            border-radius: var(--bs-border-radius);
            pointer-events: none;
        }

    .dropdown-menu {
        min-width: 22rem;
    }

</style>


<nav id="{object_id}" class="navbar sticky-top navbar-expand-lg {include://color_bg.inc} {include://color_text.inc}">
    <div class="container-fluid">
        {thumbnail}
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-{object_id}" aria-controls="navbar-{object_id}" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse ms-auto" id="navbar-{object_id}">
            <ul class="navbar-nav nav-pills ms-auto">
                {children}
            </ul>
        </div>
    </div>
</nav>

<script>
    function SetActiveNavbarItems() {
        // Define the classes to add/remove
        const activeClasses = ['active', 'text-bg-primary'];

        // Get current URL path, query string, and hash
        const currentUrl = window.location.pathname + window.location.search + window.location.hash;

        // Get all nav-links within the navbar, including dropdown items
        const navLinks = document.querySelectorAll('.navbar-nav .nav-link, .navbar-nav .dropdown-item');

        // Iterate over navLinks
        for (let i = 0; i < navLinks.length; i++) {
            const link = navLinks[i];
            const href = link.getAttribute('href');

            // Ignore links with href="#" or empty href
            if (!href || href === '#' || href === '') {
                continue;
            }

            const linkUrl = new URL(link.href, window.location.origin);

            // Remove the active classes from all links
            link.classList.remove(...activeClasses);

            // Rule A: Exact URL match or homepage link when on the root
            if (
                (linkUrl.pathname === window.location.pathname) ||
                (linkUrl.pathname === '/' && window.location.pathname === '/')
            ) {
                link.classList.add(...activeClasses);
            }

            // Rule B: Current URL is a sub-folder of the link URL, but not the root
            else if (window.location.pathname.startsWith(linkUrl.pathname) && linkUrl.pathname !== '/') {
                link.classList.add(...activeClasses);
            }
        }
    }


    function InitializeNestedDropdowns() {
        const nestedDropdowns = document.querySelectorAll('.dropdown-menu .dropdown');

        for (let i = 0; i < nestedDropdowns.length; i++) {
            const submenu = nestedDropdowns[i];
            const parentLink = submenu.querySelector('.dropdown-toggle');

            parentLink.addEventListener('click', function(event) {
                event.preventDefault();
                event.stopPropagation(); // Prevent Bootstrap's logic from interfering with nested dropdowns
            });
        }
    }


    // Run the function after the DOM is loaded
    SetActiveNavbarItems();
    InitializeNestedDropdowns();
</script>
